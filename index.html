<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿‡å¹´å€’è®¡æ—¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #d4af37, #b8860b, #8b0000, #ff0000);
            height: 100vh;
            overflow: hidden;
            position: relative;
            animation: backgroundShift 10s infinite alternate;
        }

        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1; /* ç¡®ä¿åœ¨èƒŒæ™¯ä¹‹ä¸Šä½†åœ¨å†…å®¹ä¹‹ä¸‹(å¦‚æœå†…å®¹z-indexæ›´é«˜)æˆ–è€…å†…å®¹èƒŒæ™¯é€æ˜ */
        }
        
        /* ç¡®ä¿å†…å®¹åœ¨çƒŸèŠ±ä¹‹ä¸Š */
        .container {
            position: relative;
            z-index: 10;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            color: #fff;
            padding: 20px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #ff0, 0 0 20px #ff0, 0 0 30px #ff0;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 10px #ff0, 0 0 20px #ff0, 0 0 30px #ff0;
            }
            to {
                text-shadow: 0 0 15px #ff0, 0 0 25px #ff0, 0 0 35px #ff0;
            }
        }

        .full-countdown {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .time-unit-full {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            min-width: 70px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .time-unit-full span {
            font-size: 2.5em;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 0 10px #ff0;
            line-height: 1;
        }

        .time-unit-full p {
            margin-top: 8px;
            font-size: 0.9em;
            color: #fff;
            text-shadow: 0 0 5px #000;
        }

        .countdown {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            min-width: 100px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .time-unit span {
            font-size: 3.5em;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 0 10px #ff0;
            line-height: 1;
        }

        .time-unit p {
            margin-top: 10px;
            font-size: 1em;
            color: #fff;
            text-shadow: 0 0 5px #000;
        }

        .colon {
            font-size: 2.5em;
            color: #ffeb3b;
            text-shadow: 0 0 10px #ff0;
            display: flex;
            align-items: center;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .play-btn {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .play-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        
        .play-btn:active {
            transform: translateY(1px);
        }

        .play-btn.playing {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            animation: pulse 2s infinite;
        }
        
        /* å£çº¸æ¨¡å¼æŒ‰é’® */
        .wallpaper-btn {
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
        
        .wallpaper-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* å£çº¸æ¨¡å¼ä¸‹çš„æ ·å¼ */
        body.wallpaper-mode .play-btn,
        body.wallpaper-mode .wallpaper-btn,
        body.wallpaper-mode p.hint {
            display: none !important;
        }
        
        body.wallpaper-mode .container {
            transform: scale(1.1); /* ç¨å¾®æ”¾å¤§ä¸€ç‚¹è§†è§‰ä¸»ä½“ */
            transition: transform 0.5s;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        /* ç§»åŠ¨è®¾å¤‡é€‚é… */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            
            .time-unit span {
                font-size: 2.5em;
            }
            
            .time-unit {
                min-width: 80px;
                padding: 15px;
            }
            
            .time-unit-full span {
                font-size: 2em;
            }
            
            .time-unit-full {
                min-width: 60px;
                padding: 12px;
            }
            
            .colon {
                font-size: 2em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            
            .time-unit span {
                font-size: 1.8em;
            }
            
            .time-unit {
                min-width: 70px;
                padding: 12px;
            }
            
            .time-unit-full span {
                font-size: 1.5em;
            }
            
            .time-unit-full {
                min-width: 50px;
                padding: 10px;
            }
            
            .colon {
                font-size: 1.5em;
            }
            
            .full-countdown {
                gap: 5px;
            }
            
            .countdown {
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <canvas id="fireworks-canvas"></canvas>
    <div class="container">
        <h1>æ­è´ºæ–°å¹´</h1>
        
        <!-- ç®€åŒ–ç‰ˆå€’è®¡æ—¶ï¼šå¤©æ—¶åˆ†ç§’æ¯«ç§’ -->
        <div class="full-countdown">
            <div class="time-unit-full">
                <span id="days">00</span>
                <p>å¤©</p>
            </div>
            <div class="colon">:</div>
            <div class="time-unit-full">
                <span id="hours">00</span>
                <p>æ—¶</p>
            </div>
        </div>
        
        <div class="countdown">
            <div class="time-unit">
                <span id="minutes">00</span>
                <p>åˆ†</p>
            </div>
            <div class="colon">:</div>
            <div class="time-unit">
                <span id="seconds">00</span>
                <p>ç§’</p>
            </div>
            <div class="colon">:</div>
            <div class="time-unit">
                <span id="milliseconds">00</span>
                <p>æ¯«ç§’</p>
            </div>
        </div>
        
        <!-- æ·»åŠ ä¸€ä¸ªæ˜¾çœ¼çš„æ’­æ”¾æŒ‰é’® -->
        <button id="playButton" class="play-btn">ğŸµ ç‚¹å‡»æ’­æ”¾éŸ³ä¹</button>
        
        <!-- å£çº¸æ¨¡å¼æŒ‰é’® -->
        <button id="wallpaperButton" class="wallpaper-btn">ğŸ“± å¼€å¯å£çº¸å½•åˆ¶æ¨¡å¼</button>
        <p class="hint" style="font-size: 0.8em; color: rgba(255,255,255,0.7); margin-top: 10px;">(å¼€å¯ååŒå‡»å±å¹•é€€å‡º)</p>
        
        <!-- éŸ³é¢‘å…ƒç´  -->
        <audio id="bgMusic" loop preload="auto">
            <source src="music.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
        </audio>
    </div>
    
    <script>
        // è®¾ç½®ç›®æ ‡æ—¶é—´ï¼ˆè¿™é‡Œè®¾ç½®ä¸ºæ˜¥èŠ‚æ—¥æœŸï¼‰
        function getNextSpringFestival() {
            const now = new Date();
            
            // 2026å¹´æ˜¥èŠ‚æ˜¯2æœˆ17æ—¥
            const springFestival2026 = new Date(2026, 1, 17); // 2æœˆ17æ—¥ (æœˆä»½ä»0å¼€å§‹ï¼Œæ‰€ä»¥1è¡¨ç¤º2æœˆ)
            
            // å¦‚æœå½“å‰æ—¥æœŸå·²ç»è¶…è¿‡2026å¹´æ˜¥èŠ‚ï¼Œåˆ™è®¾ç½®ä¸º2027å¹´æ˜¥èŠ‚
            if (now > springFestival2026) {
                // 2027å¹´æ˜¥èŠ‚æ˜¯2æœˆ17æ—¥ (æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æŸ¥å…·ä½“çš„å†œå†æ—¥æœŸï¼Œæš‚æ—¶å‡è®¾é€»è¾‘)
                // å®é™…ä¸Š2027å¹´æ˜¥èŠ‚æ˜¯2æœˆ6æ—¥
                return new Date(2027, 1, 6);
            } else {
                return springFestival2026;
            }
        }

        let targetDate = getNextSpringFestival();

        // è·å–DOMå…ƒç´ 
        const daysElement = document.getElementById('days');
        const hoursElement = document.getElementById('hours');
        const minutesElement = document.getElementById('minutes');
        const secondsElement = document.getElementById('seconds');
        const millisecondsElement = document.getElementById('milliseconds');
        const bgMusic = document.getElementById('bgMusic');
        const playButton = document.getElementById('playButton');
        const wallpaperButton = document.getElementById('wallpaperButton');

        // æ›´æ–°å€’è®¡æ—¶å‡½æ•°
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate.getTime() - now;

            // å¦‚æœå€’è®¡æ—¶ç»“æŸ
            if (distance < 0) {
                clearInterval(countdownInterval);
                daysElement.textContent = '00';
                hoursElement.textContent = '00';
                minutesElement.textContent = '00';
                secondsElement.textContent = '00';
                millisecondsElement.textContent = '00';
                return;
            }

            // è®¡ç®—å‰©ä½™æ—¶é—´
            const totalDays = Math.floor(distance / (1000 * 60 * 60 * 24));
            
            // è®¡ç®—å°æ—¶
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const remainingAfterHours = distance % (1000 * 60 * 60);
            
            // è®¡ç®—åˆ†é’Ÿ
            const minutes = Math.floor(remainingAfterHours / (1000 * 60));
            const remainingAfterMinutes = remainingAfterHours % (1000 * 60);
            
            // è®¡ç®—ç§’
            const seconds = Math.floor(remainingAfterMinutes / 1000);
            const remainingAfterSeconds = remainingAfterMinutes % 1000;
            
            // è®¡ç®—æ¯«ç§’
            const milliseconds = Math.floor(remainingAfterSeconds / 10);

            // æ˜¾ç¤ºç»“æœ
            daysElement.textContent = totalDays.toString().padStart(2, '0');
            hoursElement.textContent = hours.toString().padStart(2, '0');
            minutesElement.textContent = minutes.toString().padStart(2, '0');
            secondsElement.textContent = seconds.toString().padStart(2, '0');
            millisecondsElement.textContent = milliseconds.toString().padStart(2, '0');
        }

        // æ¯10æ¯«ç§’æ›´æ–°ä¸€æ¬¡å€’è®¡æ—¶
        const countdownInterval = setInterval(updateCountdown, 10);

        // --- éŸ³ä¹æ’­æ”¾é€»è¾‘ä¼˜åŒ– ---

        let isMusicInitialized = false;

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonState() {
            if (bgMusic.paused) {
                playButton.textContent = 'ğŸµ ç‚¹å‡»æ’­æ”¾éŸ³ä¹';
                playButton.classList.remove('playing');
            } else {
                playButton.textContent = 'ğŸµ æš‚åœéŸ³ä¹';
                playButton.classList.add('playing');
            }
        }

        // æ’­æ”¾éŸ³ä¹çš„æ ¸å¿ƒå‡½æ•°
        function playMusic() {
            // é¦–æ¬¡æ’­æ”¾æ—¶è·³è½¬åˆ°ç¬¬18ç§’
            if (!isMusicInitialized) {
                bgMusic.currentTime = 18;
                isMusicInitialized = true;
            }

            bgMusic.muted = false; // ç¡®ä¿ä¸é™éŸ³
            bgMusic.play().then(() => {
                console.log('æ’­æ”¾æˆåŠŸ');
                updateButtonState();
            }).catch(error => {
                console.log('æ’­æ”¾å¤±è´¥ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’:', error);
                updateButtonState();
            });
        }

        // æš‚åœéŸ³ä¹
        function pauseMusic() {
            bgMusic.pause();
            updateButtonState();
        }

        // æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        if (playButton) {
            playButton.addEventListener('click', function(e) {
                e.stopPropagation(); // é˜²æ­¢å†’æ³¡è§¦å‘ document çš„ç‚¹å‡»äº‹ä»¶
                if (bgMusic.paused) {
                    playMusic();
                } else {
                    pauseMusic();
                }
            });
        }

        // å°è¯•è‡ªåŠ¨æ’­æ”¾
        function tryAutoPlay() {
            playMusic();
        }

        // é¡µé¢åŠ è½½åå°è¯•æ’­æ”¾
        window.addEventListener('load', tryAutoPlay);

        // ç›‘å¬ç”¨æˆ·äº¤äº’ï¼ˆè§¦æ‘¸æˆ–ç‚¹å‡»ä»»æ„ä½ç½®ï¼‰æ¥è§¦å‘æ’­æ”¾
        function onUserInteraction() {
            if (bgMusic.paused) {
                playMusic();
            }
            // åªè¦ç”¨æˆ·äº¤äº’è¿‡ä¸€æ¬¡ï¼Œå°±å¯ä»¥ç§»é™¤è¿™äº›å…¨å±€ç›‘å¬äº†
            // ä½†æ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·èƒ½éšæ—¶é€šè¿‡ç‚¹å‡»æŒ‰é’®æ§åˆ¶ï¼Œæˆ‘ä»¬è¿™é‡Œåªåœ¨éŸ³ä¹æœªæ’­æ”¾æ—¶å°è¯•æ’­æ”¾
            // å¦‚æœéŸ³ä¹å·²ç»åœ¨æ’­æ”¾ï¼Œè¿™é‡Œä¸åšæ“ä½œ
            
            // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸ç§»é™¤ç›‘å¬å™¨ï¼Œå› ä¸ºå¦‚æœç”¨æˆ·æš‚åœäº†ï¼Œ
            // æˆ‘ä»¬å¸Œæœ›ä¸‹æ¬¡ç‚¹å‡»å±å¹•å…¶ä»–åœ°æ–¹ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰æˆ–è€…ä¸»è¦æ˜¯ç‚¹å‡»æŒ‰é’®æ¥æ§åˆ¶ã€‚
            // ä½†ä¸ºäº†ä½“éªŒï¼Œé€šå¸¸æ˜¯ç‚¹å‡»æŒ‰é’®æ§åˆ¶ã€‚
            // è¿™é‡Œçš„ä¸»è¦ç›®çš„æ˜¯ï¼šå¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡è§¦æ‘¸å±å¹•æ—¶å°±å¼€å§‹æ’­æ”¾ã€‚
            
            // ä¸ºäº†é¿å…ç”¨æˆ·æƒ³æš‚åœæ—¶ç‚¹å‡»å±å¹•å´åˆæ’­æ”¾äº†ï¼Œæˆ‘ä»¬åªåœ¨â€œä»æœªæ’­æ”¾è¿‡â€æˆ–è€…â€œè‡ªåŠ¨æ’­æ”¾å¤±è´¥â€çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™ä¸ªé€»è¾‘ã€‚
            // ç®€å•èµ·è§ï¼šåªè¦éŸ³ä¹æ˜¯æš‚åœçš„ï¼Œä¸”ä¸æ˜¯ç‚¹å‡»äº†æŒ‰é’®ï¼ˆæŒ‰é’®æœ‰stopPropagationï¼‰ï¼Œå°±å°è¯•æ’­æ”¾ã€‚
            // å®é™…ä¸Šï¼Œä¸ºäº†é¿å…å¹²æ‰°ï¼Œæœ€å¥½æ˜¯åªç›‘å¬ä¸€æ¬¡ã€‚
            document.removeEventListener('touchstart', onUserInteraction);
            document.removeEventListener('click', onUserInteraction);
        }

        document.addEventListener('touchstart', onUserInteraction);
        document.addEventListener('click', onUserInteraction);

        // å¾®ä¿¡æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾æ”¯æŒ
        document.addEventListener("WeixinJSBridgeReady", function () {
            playMusic();
        }, false);

        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                // å›åˆ°é¡µé¢æ—¶ï¼Œå¦‚æœä¹‹å‰æ˜¯æ’­æ”¾çŠ¶æ€ï¼ˆæˆ–è€…åº”è¯¥æ’­æ”¾ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ç»§ç»­æ’­æ”¾
                // ä½†ä¸ºäº†ä¸æ‰“æ‰°ç”¨æˆ·ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšå¼ºåˆ¶æ“ä½œï¼Œé™¤éç”¨æˆ·åŸæœ¬å°±åœ¨æ’­æ”¾ä¸­è¢«ç³»ç»Ÿæš‚åœäº†
            }
        });

        // ç›‘å¬éŸ³ä¹æœ¬èº«çš„æ’­æ”¾/æš‚åœäº‹ä»¶ï¼Œç¡®ä¿æŒ‰é’®çŠ¶æ€åŒæ­¥ï¼ˆæ¯”å¦‚é€šè¿‡ç³»ç»Ÿæ§åˆ¶æ æ§åˆ¶æ—¶ï¼‰
        bgMusic.addEventListener('play', updateButtonState);
        bgMusic.addEventListener('pause', updateButtonState);
        
        // --- å£çº¸æ¨¡å¼é€»è¾‘ ---
        if (wallpaperButton) {
            wallpaperButton.addEventListener('click', (e) => {
                e.stopPropagation();
                document.body.classList.add('wallpaper-mode');
                
                // æç¤ºç”¨æˆ·
                const toast = document.createElement('div');
                toast.textContent = 'å·²è¿›å…¥çº¯å‡€æ¨¡å¼ï¼Œè¯·å¼€å§‹å½•å±ï¼åŒå‡»å±å¹•é€€å‡ºã€‚';
                toast.style.position = 'fixed';
                toast.style.top = '20px';
                toast.style.left = '50%';
                toast.style.transform = 'translateX(-50%)';
                toast.style.background = 'rgba(0,0,0,0.7)';
                toast.style.color = '#fff';
                toast.style.padding = '10px 20px';
                toast.style.borderRadius = '20px';
                toast.style.zIndex = '9999';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transition = 'opacity 1s';
                    setTimeout(() => toast.remove(), 1000);
                }, 3000);
            });
        }
        
        // åŒå‡»é€€å‡ºå£çº¸æ¨¡å¼
        let lastTap = 0;
        document.addEventListener('touchend', (e) => {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 500 && tapLength > 0) {
                document.body.classList.remove('wallpaper-mode');
            }
            lastTap = currentTime;
        });
        
        document.addEventListener('dblclick', () => {
             document.body.classList.remove('wallpaper-mode');
        });

        // åˆå§‹åŒ–å€’è®¡æ—¶
        updateCountdown();

        // --- çƒŸèŠ±åŠ¨ç”»é€»è¾‘ ---
        (function() {
            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');
            let width = window.innerWidth;
            let height = window.innerHeight;
            let particles = [];
            let fireworks = [];

            // è°ƒæ•´ç”»å¸ƒå¤§å°
            function resizeCanvas() {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            // éšæœºæ•°ç”Ÿæˆ
            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            // çƒŸèŠ±ç²’å­ç±»
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.color = color;
                    // çˆ†ç‚¸é€Ÿåº¦
                    const angle = random(0, Math.PI * 2);
                    const speed = random(2, 10);
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                    this.alpha = 1;
                    this.decay = random(0.015, 0.03); // æ¶ˆå¤±é€Ÿåº¦
                    this.gravity = 0.05; // é‡åŠ›
                }

                update() {
                    this.vx *= 0.95; // ç©ºæ°”é˜»åŠ›
                    this.vy *= 0.95;
                    this.vy += this.gravity;
                    this.x += this.vx;
                    this.y += this.vy;
                    this.alpha -= this.decay;
                }

                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }

            // çƒŸèŠ±å‘å°„ç±»
            class Firework {
                constructor() {
                    this.x = random(width * 0.1, width * 0.9);
                    this.y = height;
                    this.targetY = random(height * 0.1, height * 0.4);
                    this.color = `hsl(${random(0, 360)}, 100%, 50%)`;
                    this.speed = random(8, 12);
                    this.angle = -Math.PI / 2 + random(-0.1, 0.1); // ç¨å¾®åæ–œ
                    this.vx = Math.cos(this.angle) * this.speed;
                    this.vy = Math.sin(this.angle) * this.speed;
                    this.trail = [];
                    this.exploded = false;
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += 0.05; // é‡åŠ›

                    // è®°å½•è½¨è¿¹
                    this.trail.push({x: this.x, y: this.y});
                    if (this.trail.length > 5) this.trail.shift();

                    // åˆ°è¾¾ç›®æ ‡é«˜åº¦æˆ–å¼€å§‹ä¸‹è½æ—¶çˆ†ç‚¸
                    if (this.vy >= 0 || this.y <= this.targetY) {
                        this.explode();
                        return false; // ç§»é™¤çƒŸèŠ±
                    }
                    return true; // ç»§ç»­ä¸Šå‡
                }

                draw() {
                    ctx.save();
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    if (this.trail.length > 0) {
                        ctx.moveTo(this.trail[0].x, this.trail[0].y);
                        for (let i = 1; i < this.trail.length; i++) {
                            ctx.lineTo(this.trail[i].x, this.trail[i].y);
                        }
                        ctx.lineTo(this.x, this.y);
                    }
                    ctx.stroke();
                    ctx.restore();
                }

                explode() {
                    const particleCount = 100;
                    for (let i = 0; i < particleCount; i++) {
                        particles.push(new Particle(this.x, this.y, this.color));
                    }
                }
            }

            // åŠ¨ç”»å¾ªç¯
            function animate() {
                // æ‹–å°¾æ•ˆæœ
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; 
                // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æ ¹æ®èƒŒæ™¯è°ƒæ•´ã€‚å› ä¸ºèƒŒæ™¯æ˜¯æ¸å˜è‰²ï¼Œç”¨é»‘è‰²é®ç½©å¯èƒ½æ˜¾å¾—è„ã€‚
                // æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ clearRectï¼Œä½†é‚£æ ·å°±æ²¡æœ‰æ‹–å°¾äº†ã€‚
                // æ—¢ç„¶èƒŒæ™¯æ˜¯å¤æ‚çš„CSSæ¸å˜ï¼Œç”¨é€æ˜åº¦æ¸…ç©ºæ˜¯ä¸ªæŒ‘æˆ˜ã€‚
                // æœ€å¥½çš„åŠæ³•æ˜¯åªæ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, width, height);

                // éšæœºå‘å°„çƒŸèŠ±
                if (Math.random() < 0.05) { // è°ƒæ•´å‘å°„é¢‘ç‡
                    fireworks.push(new Firework());
                }

                // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
                for (let i = fireworks.length - 1; i >= 0; i--) {
                    if (!fireworks[i].update()) {
                        fireworks.splice(i, 1);
                    } else {
                        fireworks[i].draw();
                    }
                }

                // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    particles[i].draw();
                    if (particles[i].alpha <= 0) {
                        particles.splice(i, 1);
                    }
                }

                requestAnimationFrame(animate);
            }

            animate();
        })();
    </script>
</body>
</html>
